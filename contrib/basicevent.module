<code><font color="#000000">
<font color="#0000BB">&lt;?php<br /></font><font color="#FF8000">//&nbsp;$Id$<br /><br />/**<br />&nbsp;*&nbsp;@file<br />&nbsp;*&nbsp;A&nbsp;story-like&nbsp;module&nbsp;with&nbsp;event&nbsp;information&nbsp;built&nbsp;in.<br />&nbsp;*/<br /><br />/**<br />&nbsp;*&nbsp;Implementation&nbsp;of&nbsp;hook_help().<br />&nbsp;*/<br /></font><font color="#007700">function&nbsp;</font><font color="#0000BB">basicevent_help</font><font color="#007700">(</font><font color="#0000BB">$section</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;switch&nbsp;(</font><font color="#0000BB">$section</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</font><font color="#DD0000">'admin/modules#description'</font><font color="#007700">:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</font><font color="#0000BB">t</font><font color="#007700">(</font><font color="#DD0000">'A&nbsp;story-like&nbsp;node&nbsp;that&nbsp;implements&nbsp;the&nbsp;event&nbsp;API&nbsp;automatically.&nbsp;Depends&nbsp;on&nbsp;the&nbsp;event&nbsp;module&nbsp;(4.6&nbsp;or&nbsp;later).'</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</font><font color="#DD0000">'node/add#event'</font><font color="#007700">:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</font><font color="#0000BB">t</font><font color="#007700">(</font><font color="#DD0000">'An&nbsp;event&nbsp;is&nbsp;a&nbsp;story&nbsp;which&nbsp;can&nbsp;be&nbsp;given&nbsp;a&nbsp;start&nbsp;and&nbsp;end&nbsp;date,&nbsp;thus&nbsp;appearing&nbsp;in&nbsp;the&nbsp;events&nbsp;calendar.'</font><font color="#007700">);<br />&nbsp;&nbsp;}<br />}<br /><br /></font><font color="#FF8000">/**<br />&nbsp;*&nbsp;Implementation&nbsp;of&nbsp;hook_node_name().<br />&nbsp;*/<br /></font><font color="#007700">function&nbsp;</font><font color="#0000BB">event_node_name</font><font color="#007700">(</font><font color="#0000BB">$node</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;return&nbsp;</font><font color="#0000BB">t</font><font color="#007700">(</font><font color="#DD0000">'event'</font><font color="#007700">);<br />}<br /><br /></font><font color="#FF8000">/**<br />&nbsp;*&nbsp;Implementation&nbsp;of&nbsp;hook_perm().<br />&nbsp;*/<br /></font><font color="#007700">function&nbsp;</font><font color="#0000BB">event_perm</font><font color="#007700">()&nbsp;{<br />&nbsp;&nbsp;return&nbsp;array(</font><font color="#DD0000">'create&nbsp;events'</font><font color="#007700">,&nbsp;</font><font color="#DD0000">'edit&nbsp;own&nbsp;events'</font><font color="#007700">);<br />}<br /><br /></font><font color="#FF8000">/**<br />&nbsp;*&nbsp;Implementation&nbsp;of&nbsp;hook_access().<br />&nbsp;*/<br /></font><font color="#007700">function&nbsp;</font><font color="#0000BB">event_access</font><font color="#007700">(</font><font color="#0000BB">$op</font><font color="#007700">,&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;global&nbsp;</font><font color="#0000BB">$user</font><font color="#007700">;<br /><br />&nbsp;&nbsp;if&nbsp;(</font><font color="#0000BB">$op&nbsp;</font><font color="#007700">==&nbsp;</font><font color="#DD0000">'create'</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</font><font color="#0000BB">user_access</font><font color="#007700">(</font><font color="#DD0000">'create&nbsp;events'</font><font color="#007700">);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;if&nbsp;(</font><font color="#0000BB">$op&nbsp;</font><font color="#007700">==&nbsp;</font><font color="#DD0000">'update'&nbsp;</font><font color="#007700">||&nbsp;</font><font color="#0000BB">$op&nbsp;</font><font color="#007700">==&nbsp;</font><font color="#DD0000">'delete'</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</font><font color="#0000BB">user_access</font><font color="#007700">(</font><font color="#DD0000">'edit&nbsp;own&nbsp;events'</font><font color="#007700">)&nbsp;&amp;&amp;&nbsp;(</font><font color="#0000BB">$user</font><font color="#007700">-&gt;</font><font color="#0000BB">uid&nbsp;</font><font color="#007700">==&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">uid</font><font color="#007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</font><font color="#0000BB">TRUE</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br />}<br /><br /></font><font color="#FF8000">/**<br />&nbsp;*&nbsp;Implementation&nbsp;of&nbsp;hook_menu().<br />&nbsp;*/<br /></font><font color="#007700">function&nbsp;</font><font color="#0000BB">basicevent_menu</font><font color="#007700">(</font><font color="#0000BB">$may_cache</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;</font><font color="#0000BB">$items&nbsp;</font><font color="#007700">=&nbsp;array();<br /><br />&nbsp;&nbsp;if&nbsp;(</font><font color="#0000BB">$may_cache</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$items</font><font color="#007700">[]&nbsp;=&nbsp;array(</font><font color="#DD0000">'path'&nbsp;</font><font color="#007700">=&gt;&nbsp;</font><font color="#DD0000">'node/add/event'</font><font color="#007700">,&nbsp;</font><font color="#DD0000">'title'&nbsp;</font><font color="#007700">=&gt;&nbsp;</font><font color="#0000BB">t</font><font color="#007700">(</font><font color="#DD0000">'event'</font><font color="#007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">'access'&nbsp;</font><font color="#007700">=&gt;&nbsp;</font><font color="#0000BB">user_access</font><font color="#007700">(</font><font color="#DD0000">'create&nbsp;events'</font><font color="#007700">));<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;return&nbsp;</font><font color="#0000BB">$items</font><font color="#007700">;<br />}<br /><br /></font><font color="#FF8000">/**<br />&nbsp;*&nbsp;Implementation&nbsp;of&nbsp;hook_form().<br />&nbsp;*/<br /></font><font color="#007700">function&nbsp;</font><font color="#0000BB">event_form</font><font color="#007700">(&amp;</font><font color="#0000BB">$node</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;</font><font color="#0000BB">$output&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#DD0000">''</font><font color="#007700">;<br /><br />&nbsp;&nbsp;if&nbsp;(</font><font color="#0000BB">function_exists</font><font color="#007700">(</font><font color="#DD0000">'taxonomy_node_form'</font><font color="#007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$output&nbsp;</font><font color="#007700">.=&nbsp;</font><font color="#0000BB">implode</font><font color="#007700">(</font><font color="#DD0000">''</font><font color="#007700">,&nbsp;</font><font color="#0000BB">taxonomy_node_form</font><font color="#007700">(</font><font color="#DD0000">'event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">));<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;</font><font color="#0000BB">$output&nbsp;</font><font color="#007700">.=&nbsp;</font><font color="#0000BB">form_textarea</font><font color="#007700">(</font><font color="#0000BB">t</font><font color="#007700">(</font><font color="#DD0000">'Body'</font><font color="#007700">),&nbsp;</font><font color="#DD0000">'body'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">body</font><font color="#007700">,&nbsp;</font><font color="#0000BB">60</font><font color="#007700">,&nbsp;</font><font color="#0000BB">20</font><font color="#007700">,&nbsp;</font><font color="#DD0000">''</font><font color="#007700">,&nbsp;</font><font color="#0000BB">NULL</font><font color="#007700">,&nbsp;</font><font color="#0000BB">TRUE</font><font color="#007700">);<br />&nbsp;&nbsp;</font><font color="#0000BB">$output&nbsp;</font><font color="#007700">.=&nbsp;</font><font color="#0000BB">filter_form</font><font color="#007700">(</font><font color="#DD0000">'format'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">format</font><font color="#007700">);<br /><br />&nbsp;&nbsp;if&nbsp;(!</font><font color="#0000BB">module_exist</font><font color="#007700">(</font><font color="#DD0000">'location'</font><font color="#007700">)&nbsp;||&nbsp;!</font><font color="#0000BB">variable_get</font><font color="#007700">(</font><font color="#DD0000">'location_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">0</font><font color="#007700">))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$output&nbsp;</font><font color="#007700">.=&nbsp;</font><font color="#DD0000">'&lt;div&nbsp;class="container-inline"&gt;'</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$output&nbsp;</font><font color="#007700">.=&nbsp;</font><font color="#0000BB">form_textfield</font><font color="#007700">(</font><font color="#0000BB">t</font><font color="#007700">(</font><font color="#DD0000">'Location&nbsp;Name'</font><font color="#007700">),&nbsp;</font><font color="#DD0000">'location][name'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">location</font><font color="#007700">[</font><font color="#DD0000">'name'</font><font color="#007700">],&nbsp;</font><font color="#0000BB">64</font><font color="#007700">,&nbsp;</font><font color="#0000BB">64</font><font color="#007700">,&nbsp;</font><font color="#0000BB">t</font><font color="#007700">(</font><font color="#DD0000">'e.g.&nbsp;a&nbsp;place&nbsp;of&nbsp;business,&nbsp;venue,&nbsp;meeting&nbsp;point'</font><font color="#007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$output&nbsp;</font><font color="#007700">.=&nbsp;</font><font color="#DD0000">"&lt;/div&gt;\n"</font><font color="#007700">;<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;return&nbsp;</font><font color="#0000BB">$output</font><font color="#007700">;<br />}<br /><br /></font><font color="#FF8000">/*<br />&nbsp;*&nbsp;Implementation&nbsp;of&nbsp;hook_init()<br />&nbsp;*/<br /></font><font color="#007700">function&nbsp;</font><font color="#0000BB">basicevent_init</font><font color="#007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</font><font color="#0000BB">variable_get</font><font color="#007700">(</font><font color="#DD0000">'event_nodeapi_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">FALSE</font><font color="#007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">variable_set</font><font color="#007700">(</font><font color="#DD0000">'event_nodeapi_event'</font><font color="#007700">,&nbsp;</font><font color="#DD0000">'all'</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#DD0000">"DELETE&nbsp;FROM&nbsp;{cache}"</font><font color="#007700">);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">watchdog</font><font color="#007700">(</font><font color="#DD0000">'regular'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">t</font><font color="#007700">(</font><font color="#DD0000">'Initialized&nbsp;event&nbsp;as&nbsp;event&nbsp;bearing&nbsp;module'</font><font color="#007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;if&nbsp;(</font><font color="#0000BB">module_exist</font><font color="#007700">(</font><font color="#DD0000">'location'</font><font color="#007700">)&nbsp;&amp;&amp;&nbsp;!</font><font color="#0000BB">variable_get</font><font color="#007700">(</font><font color="#DD0000">'location_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">0</font><font color="#007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">variable_set</font><font color="#007700">(</font><font color="#DD0000">'location_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">1</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">variable_set</font><font color="#007700">(</font><font color="#DD0000">'location_name_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">1</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">variable_set</font><font color="#007700">(</font><font color="#DD0000">'location_street_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">0</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">variable_set</font><font color="#007700">(</font><font color="#DD0000">'location_city_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">0</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">variable_set</font><font color="#007700">(</font><font color="#DD0000">'location_province_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">0</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">variable_set</font><font color="#007700">(</font><font color="#DD0000">'location_country_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">0</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">variable_set</font><font color="#007700">(</font><font color="#DD0000">'location_postal_code_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">0</font><font color="#007700">);<br />&nbsp;&nbsp;}<br />}<br /><br /></font><font color="#FF8000">/**&nbsp;<br />&nbsp;*&nbsp;Implementation&nbsp;of&nbsp;hook_load()<br />&nbsp;*&nbsp;<br />&nbsp;*&nbsp;Here&nbsp;is&nbsp;where&nbsp;we&nbsp;set&nbsp;$node-&gt;show_as_event<br />&nbsp;*&nbsp;The&nbsp;event.module&nbsp;does&nbsp;the&nbsp;rest.<br />&nbsp;*/<br /></font><font color="#007700">function&nbsp;</font><font color="#0000BB">event_load</font><font color="#007700">(</font><font color="#0000BB">$node</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;if&nbsp;(!</font><font color="#0000BB">module_exist</font><font color="#007700">(</font><font color="#DD0000">'location'</font><font color="#007700">)&nbsp;||&nbsp;!</font><font color="#0000BB">variable_get</font><font color="#007700">(</font><font color="#DD0000">'location_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">0</font><font color="#007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$additions&nbsp;</font><font color="#007700">=&nbsp;array(</font><font color="#DD0000">'show_as_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">variable_get</font><font color="#007700">(</font><font color="#DD0000">'event_nodeapi_basicevent'</font><font color="#007700">,&nbsp;</font><font color="#DD0000">'all'</font><font color="#007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$result&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#0000BB">db_fetch_array</font><font color="#007700">(</font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#DD0000">"SELECT&nbsp;name,&nbsp;street,&nbsp;additional,&nbsp;city,&nbsp;province,&nbsp;postal_code,&nbsp;country&nbsp;FROM&nbsp;{location}&nbsp;WHERE&nbsp;oid&nbsp;=&nbsp;%d&nbsp;and&nbsp;type='node'"</font><font color="#007700">,&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">nid</font><font color="#007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</font><font color="#0000BB">is_array</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</font><font color="#0000BB">$result&nbsp;</font><font color="#007700">as&nbsp;</font><font color="#0000BB">$name&nbsp;</font><font color="#007700">=&gt;&nbsp;</font><font color="#0000BB">$value</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$additions</font><font color="#007700">[</font><font color="#DD0000">'location'</font><font color="#007700">][</font><font color="#0000BB">$name</font><font color="#007700">]&nbsp;=&nbsp;</font><font color="#0000BB">$value</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</font><font color="#0000BB">$additions</font><font color="#007700">;<br />&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</font><font color="#0000BB">basicevent_insert</font><font color="#007700">(</font><font color="#0000BB">$node</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;if&nbsp;(!</font><font color="#0000BB">module_exist</font><font color="#007700">(</font><font color="#DD0000">'location'</font><font color="#007700">)&nbsp;||&nbsp;!</font><font color="#0000BB">variable_get</font><font color="#007700">(</font><font color="#DD0000">'location_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">0</font><font color="#007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#DD0000">"INSERT&nbsp;INTO&nbsp;{location}&nbsp;(oid,&nbsp;type,&nbsp;name,&nbsp;street,&nbsp;additional,&nbsp;city,&nbsp;province,&nbsp;postal_code,&nbsp;country)&nbsp;VALUES&nbsp;(%d,&nbsp;'node',&nbsp;'%s',&nbsp;'%s',&nbsp;'%s',&nbsp;'%s',&nbsp;'%s',&nbsp;'%s',&nbsp;'%s')"</font><font color="#007700">,&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">nid</font><font color="#007700">,&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">location</font><font color="#007700">[</font><font color="#DD0000">'name'</font><font color="#007700">],&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">location</font><font color="#007700">[</font><font color="#DD0000">'street'</font><font color="#007700">],&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">location</font><font color="#007700">[</font><font color="#DD0000">'additional'</font><font color="#007700">],&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">location</font><font color="#007700">[</font><font color="#DD0000">'city'</font><font color="#007700">],&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">location</font><font color="#007700">[</font><font color="#DD0000">'province'</font><font color="#007700">],&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">location</font><font color="#007700">[</font><font color="#DD0000">'postal_code'</font><font color="#007700">],&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">location</font><font color="#007700">[</font><font color="#DD0000">'country'</font><font color="#007700">]);<br />&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</font><font color="#0000BB">basicevent_delete</font><font color="#007700">(</font><font color="#0000BB">$node</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;if&nbsp;(!</font><font color="#0000BB">module_exist</font><font color="#007700">(</font><font color="#DD0000">'location'</font><font color="#007700">)&nbsp;||&nbsp;!</font><font color="#0000BB">variable_get</font><font color="#007700">(</font><font color="#DD0000">'location_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">0</font><font color="#007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#DD0000">"DELETE&nbsp;FROM&nbsp;{location}&nbsp;WHERE&nbsp;oid&nbsp;=&nbsp;%d&nbsp;and&nbsp;type='node'"</font><font color="#007700">,&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">nid</font><font color="#007700">);<br />&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</font><font color="#0000BB">event_update</font><font color="#007700">(</font><font color="#0000BB">$node</font><font color="#007700">)&nbsp;{<br /><br />&nbsp;&nbsp;if&nbsp;(!</font><font color="#0000BB">module_exist</font><font color="#007700">(</font><font color="#DD0000">'location'</font><font color="#007700">)&nbsp;||&nbsp;!</font><font color="#0000BB">variable_get</font><font color="#007700">(</font><font color="#DD0000">'location_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">0</font><font color="#007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#DD0000">'LOCK&nbsp;TABLES&nbsp;{location}&nbsp;WRITE'</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">basicevent_delete</font><font color="#007700">(</font><font color="#0000BB">$node</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">basicevent_insert</font><font color="#007700">(</font><font color="#0000BB">$node</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">db_query</font><font color="#007700">(</font><font color="#DD0000">'UNLOCK&nbsp;TABLES'</font><font color="#007700">);<br />&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</font><font color="#0000BB">event_view</font><font color="#007700">(&amp;</font><font color="#0000BB">$node</font><font color="#007700">,&nbsp;</font><font color="#0000BB">$teaser&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#0000BB">FALSE</font><font color="#007700">,&nbsp;</font><font color="#0000BB">$page&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#0000BB">FALSE</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;if&nbsp;(!</font><font color="#0000BB">module_exist</font><font color="#007700">(</font><font color="#DD0000">'location'</font><font color="#007700">)&nbsp;||&nbsp;!</font><font color="#0000BB">variable_get</font><font color="#007700">(</font><font color="#DD0000">'location_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">0</font><font color="#007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">body&nbsp;</font><font color="#007700">.=&nbsp;</font><font color="#0000BB">theme</font><font color="#007700">(</font><font color="#DD0000">'location_event'</font><font color="#007700">,&nbsp;</font><font color="#0000BB">$node</font><font color="#007700">-&gt;</font><font color="#0000BB">location</font><font color="#007700">);<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;</font><font color="#0000BB">$node&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#0000BB">node_prepare</font><font color="#007700">(</font><font color="#0000BB">$node</font><font color="#007700">,&nbsp;</font><font color="#0000BB">$teaser</font><font color="#007700">);<br />}&nbsp;<br /><br /><br />function&nbsp;</font><font color="#0000BB">theme_location_event</font><font color="#007700">(</font><font color="#0000BB">$location</font><font color="#007700">)&nbsp;{<br />&nbsp;&nbsp;return&nbsp;</font><font color="#DD0000">"&lt;div&nbsp;class='location'&gt;"&nbsp;</font><font color="#007700">.&nbsp;</font><font color="#0000BB">$location</font><font color="#007700">-&gt;</font><font color="#0000BB">name&nbsp;</font><font color="#007700">.&nbsp;</font><font color="#DD0000">"&lt;/div&gt;"</font><font color="#007700">;<br />}<br /><br /></font><font color="#0000BB">?&gt;<br /></font>
</font>
</code>